name: STG_HASH_INVENTORY
id: 61369b42-a7df-4b81-ab83-3315dd130ffd
storageLocationId: f444de18-2d02-4df6-9c54-36ca0a2c7e40
templateId: c9972b75-8b77-4599-8631-351a18354a4f
materialization: table
isSource: false
columns:
  - name: INVENTORY_HK
    dataType: BINARY(20)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 51d43c86-ed3c-4e2e-9064-d935e4631d1f
    isPK: true
  - name: PART_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: part of unique identifier with ps_suppkey
    id: 3dd35cf7-226f-428c-8758-a1471cfee27b
    isBK: true
  - name: SUPPLIER_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: part of unique identifier with ps_partkey
    id: c995d4e5-eebe-474c-8b00-f224c172fe62
  - name: AVAILABLE_AMOUNT
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: number of parts available for sale
    id: ab602290-c9dc-4799-9569-b3ad52152060
  - name: SUPPLIER_COST_USD
    dataType: number(12,2)
    allowNulls: false
    defaultValue: ''
    description: original cost paid to supplier
    id: 97cc6424-caf5-47e2-bd7e-e5afae112d0f
  - name: COMMENT
    dataType: varchar(16777216)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: 1d15fd08-6c5c-4641-819d-57eaa280f729
  - name: __LOAD_DTS
    dataType: timestamp_ltz(9)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: 3f0c4892-670f-4ca5-b3a9-66d66761e527
    isNONDELTA: true
  - name: __LOAD_DATE_TS
    dataType: TIMESTAMP
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: ''
    id: 0091c589-6e36-47f2-ba73-44f688d7d270
    isNONDELTA: true
  - name: __RECORD_SOURCE
    dataType: VARCHAR(50)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 962d130f-3daf-456b-9e85-9564af8b320d
    isNONDELTA: true
  - name: __TRANSACTIONAL_DATE_TS
    dataType: TIMESTAMP
    allowNulls: true
    defaultValue: ''
    description: ''
    id: fc7392d9-8c0f-40be-9207-210223e3a81b
    isNONDELTA: true
  - name: __HASHDIFF
    dataType: BINARY(20)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 42fe01fb-b958-43d2-b43e-5acd13ca5aa9
    isNONDELTA: true
columnSets:
  - id: 5a20306c-9f72-4349-a69e-b49d25864483
    itemName: PK
    setName: PK_STG_HASH_INVENTORY
    columns:
      - columnId: 51d43c86-ed3c-4e2e-9064-d935e4631d1f
        position: 1
        name: INVENTORY_HK
        useQuotes: false
  - id: e5b299f0-1745-43ee-a13b-204b7fee4633
    itemName: NONDELTA
    setName: NONDELTA_STG_HASH_INVENTORY
    columns:
      - columnId: 42fe01fb-b958-43d2-b43e-5acd13ca5aa9
        position: 1
        name: __HASHDIFF
        useQuotes: false
      - columnId: 0091c589-6e36-47f2-ba73-44f688d7d270
        position: 2
        name: __LOAD_DATE_TS
        useQuotes: false
      - columnId: 3f0c4892-670f-4ca5-b3a9-66d66761e527
        position: 3
        name: __LOAD_DTS
        useQuotes: false
      - columnId: 962d130f-3daf-456b-9e85-9564af8b320d
        position: 4
        name: __RECORD_SOURCE
        useQuotes: false
      - columnId: fc7392d9-8c0f-40be-9207-210223e3a81b
        position: 5
        name: __TRANSACTIONAL_DATE_TS
        useQuotes: false
  - id: 9bdb4c6e-fdb8-4f5d-8956-fcff31a93c36
    itemName: BK
    setName: BK_STG_HASH_INVENTORY
    columns:
      - columnId: 3dd35cf7-226f-428c-8758-a1471cfee27b
        position: 1
        name: PART_ID
        useQuotes: false
nodeFormat: dynamic
parentName: Processing_layer
status: ValidateRunFailed
color: '#999999'
logic: |-
  with "INVENTORY" as (
      SELECT
          "PART_ID",
          "SUPPLIER_ID",
          "AVAILABLE_AMOUNT",
          "SUPPLIER_COST_USD",
          "COMMENT",
          "__LOAD_DTS"
      FROM {{ref('RAW', 'INVENTORY')}}
  )
  ,
  common as (
      SELECT
          CAST(({{generateHashKey('BK','FALSE')}}) AS BINARY(20)) AS "INVENTORY_HK",
          "INVENTORY"."PART_ID",
          "INVENTORY"."SUPPLIER_ID",
          "INVENTORY"."AVAILABLE_AMOUNT",
          "INVENTORY"."SUPPLIER_COST_USD",
          "INVENTORY"."COMMENT",
          "INVENTORY"."__LOAD_DTS",
          current_timestamp() AS "__LOAD_DATE_TS",
          '{{location.name}}' AS "__RECORD_SOURCE",
          {{returnColumn('TDF')}} AS "__TRANSACTIONAL_DATE_TS",
          CAST(({{generateHashKey('NONDELTA','TRUE')}}) AS BINARY(20)) AS "__HASHDIFF"
      FROM "INVENTORY"
  )

  SELECT * FROM common
description: ''
logicalName: INVENTORY Hash Stage
references:
  1c9f21e8-a814-4ff4-8e5e-f6e73168555b:
    parentTableId: 05482f6b-5f10-4b87-b611-bf986c50636a
    id: 1c9f21e8-a814-4ff4-8e5e-f6e73168555b
