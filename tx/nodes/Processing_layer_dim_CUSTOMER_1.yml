name: dim_CUSTOMER_1
color: '#8E44AD'
isSource: false
columns:
  - name: CUSTOMER_ID
    allowNulls: false
    dataType: number(38,0)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: c2932e7e-403b-47da-b61a-add344a7010e
    isPK: true
    isBK: true
  - name: __FROM_DTS
    allowNulls: false
    dataType: timestamp_ntz
    defaultValue: CURRENT_TIMESTAMP()
    description: when record was loaded into the warehouse
    useQuotes: false
    id: d2d9a13e-62f4-41f9-a6b7-6efcf4f8ce50
    isPK: true
  - name: __TO_DTS
    allowNulls: false
    dataType: timestamp_ntz
    defaultValue: CURRENT_TIMESTAMP()
    description: effective date or surrogate high date (9999-12-31)
    useQuotes: false
    id: ceeb1a65-7a88-4827-b2ae-4389e080830d
  - name: NAME
    allowNulls: false
    dataType: varchar(16777216)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 67f0bef9-d66a-4cee-ac2e-1feec3c4ff9d
  - name: ADDRESS
    allowNulls: false
    dataType: varchar(16777216)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 93658c90-8913-4ca1-9e51-8ef5873757d2
  - name: LOCATION_ID
    allowNulls: false
    dataType: number(38,0)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 2f9c8fd5-be61-402b-b6e2-a3dd42661c6d
  - name: PHONE
    allowNulls: false
    dataType: varchar(15)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 57aa8246-128a-44c9-8c14-3ebc0a849a31
  - name: ACCOUNT_BALANCE_USD
    allowNulls: false
    dataType: number(12,2)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: ba215659-f92c-424f-a20a-5f7707d6b256
  - name: MARKET_SEGMENT
    allowNulls: false
    dataType: varchar(10)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 3ce58624-080e-4002-ad29-b98efeb4c217
  - name: COMMENT
    allowNulls: true
    dataType: varchar(16777216)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: a9b4cbad-9a80-4707-b580-8741edc5c267
  - name: __LOAD_DTS
    allowNulls: true
    dataType: timestamp_ltz(9)
    defaultValue: ''
    description: ''
    useQuotes: false
    id: 02d42069-1c8d-40ba-8413-6ac413c67ee7
    issysTimestamp: true
  - name: __REC_VERSION
    allowNulls: false
    dataType: number(38,0)
    defaultValue: '1'
    description: incremental change version counter for the record
    useQuotes: false
    id: c031b780-3168-4912-9fcc-fe7279071e7a
  - name: __IS_LATEST
    allowNulls: false
    dataType: boolean
    defaultValue: 'true'
    description: true only on the latest effective dated record
    useQuotes: false
    id: e59d70e2-82ca-4a05-80dc-2c3b9719add7
  - name: __CREATE_DTS
    allowNulls: false
    dataType: timestamp_ntz
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was first created
    useQuotes: false
    id: 27886de7-6c84-43cd-908f-2a44a9ad4227
  - name: __UPDATE_DTS
    allowNulls: false
    dataType: timestamp_ntz
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was last updated
    useQuotes: false
    id: 4f66e9a4-6a3c-4a5f-90a6-d28ac6362ff2
  - name: __T2DIFF_HASH
    allowNulls: false
    dataType: binary(20)
    defaultValue: ''
    description: hash of all columns used for quick compare
    useQuotes: false
    id: e2949f4d-43a6-4668-bdc4-fb580198c162
  - name: __T1DIFF_HASH
    allowNulls: false
    dataType: binary(20)
    defaultValue: ''
    description: hash of all columns used for quick compare
    useQuotes: false
    id: 7a53b982-d849-4487-a267-030b7114d307
logic: |-
  with CUSTOMER as (
      SELECT
          CUSTOMER_ID,
          NAME,
          ADDRESS,
          LOCATION_ID,
          PHONE,
          ACCOUNT_BALANCE_USD,
          MARKET_SEGMENT,
          COMMENT,
          __LOAD_DTS
      FROM {{ref('RAW', 'CUSTOMER')}}
      WHERE TRUE 
      AND {% for colSet in columnSets -%}
                   {%- if colSet.itemName == 'sysTimestamp' -%}
                     {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} {{' '-}}
                     {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
                     {%- endif -%}
                   {%- endif -%}
                 {%- endfor -%} 
      = (SELECT MAX( {%- for colSet in columnSets -%}
                   {%- if colSet.itemName == 'sysTimestamp' -%}
                     {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} 
                     {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
                     {%- endif -%}
                   {%- endif -%}
                 {%- endfor -%}) FROM {{ref('RAW', 'CUSTOMER')}})  

  )
  ,
  common as (
      SELECT
          CUSTOMER.CUSTOMER_ID,
          {% for colSet in columnSets -%}
            {%- if colSet.itemName == 'sysTimestamp' -%}
              {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} {{' '-}}
              {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%} 
   AS __FROM_DTS,
          '9999-12-31'::TIMESTAMP_NTZ AS __TO_DTS,
          CUSTOMER.NAME,
          CUSTOMER.ADDRESS,
          CUSTOMER.LOCATION_ID,
          CUSTOMER.PHONE,
          CUSTOMER.ACCOUNT_BALANCE_USD,
          CUSTOMER.MARKET_SEGMENT,
          CUSTOMER.COMMENT,
          CUSTOMER.__LOAD_DTS,
          1 AS __REC_VERSION,
          true AS __IS_LATEST,
          CURRENT_TIMESTAMP() AS __CREATE_DTS,
          CURRENT_TIMESTAMP() AS __UPDATE_DTS,
          SHA1_BINARY( {%- for col in columns if ( not ( col.name == '__REC_VERSION' or
                                         col.name == '__IS_LATEST' or
                                         col.name == '__FROM_DTS' or
                                         col.name == '__TO_DTS' or
                                         col.name == '__CREATE_DTS' or
                                         col.name == '__UPDATE_DTS' or
                                         col.name == '__T2DIFF_HASH' or
                                         col.name == '__T1DIFF_HASH' or
                                         col.isSysTimestamp )
                                         and (
                                         col.isDELTA or
                                         isAllDelta
                                         )
                                         ) %}
              NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}
            {%- endfor %}
                  )::BINARY(20) AS __T2DIFF_HASH,
          SHA1_BINARY({% if isAllDelta -%} '*null*'{% else %}
              {%- for col in columns if not ( col.name == '__REC_VERSION' or
                                            col.name == '__IS_LATEST' or
                                            col.name == '__FROM_DTS' or
                                            col.name == '__TO_DTS' or
                                            col.name == '__CREATE_DTS' or
                                            col.name == '__UPDATE_DTS' or
                                            col.name == '__T2DIFF_HASH' or
                                            col.name == '__T1DIFF_HASH' or
                                            col.isDELTA or
                                            col.isSysTimestamp ) %}
               NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}
                {%- endfor -%}
            {% endif -%}
            )::BINARY(20) AS __T1DIFF_HASH
      FROM CUSTOMER
  )

  SELECT * FROM common
description: ''
logicalName: CUSTOMER dimension
columnSets:
  - itemName: PK
    setName: PK_dim_CUSTOMER_1
    columns:
      - columnId: c2932e7e-403b-47da-b61a-add344a7010e
        position: 1
        name: CUSTOMER_ID
        useQuotes: false
      - columnId: d2d9a13e-62f4-41f9-a6b7-6efcf4f8ce50
        position: 2
        name: __FROM_DTS
        useQuotes: false
    id: 46509fa2-5e9d-42d5-9000-7a6e922adea1
  - itemName: BK
    setName: BK_dim_CUSTOMER_1
    columns:
      - columnId: c2932e7e-403b-47da-b61a-add344a7010e
        position: 1
        name: CUSTOMER_ID
        useQuotes: false
    id: 3a1e47e2-08bb-4184-9d3f-ee555be80b91
  - itemName: sysTimestamp
    setName: sysTimestamp_dim_CUSTOMER_1
    columns:
      - columnId: 02d42069-1c8d-40ba-8413-6ac413c67ee7
        position: 1
        name: __LOAD_DTS
        useQuotes: false
    id: 036fdc93-b6e8-4502-b0f0-88ccf2ae20a8
useQuotes: false
templateId: 5a7aea4c-5adb-41ae-a296-300f66bbd5e4
materialization: table
storageLocationId: f444de18-2d02-4df6-9c54-36ca0a2c7e40
preCreate:
  value:
    - ''
  isValidated: true
postCreate:
  value:
    - ''
  isValidated: true
preRun:
  value:
    - ''
  isValidated: true
postRun:
  value:
    - ''
  isValidated: true
isAllDelta: true
rely_button: true
id: 917bb5a8-4c6b-40d1-b4b4-89d9f6d7bb99
nodeFormat: dynamic
status: ValidateRunSuccess
references:
  1ca7df5c-5a9a-4666-b836-b03a63009de4:
    parentTableId: 39bd16bc-a498-452c-9cba-9defbf84426c
    id: 1ca7df5c-5a9a-4666-b836-b03a63009de4
