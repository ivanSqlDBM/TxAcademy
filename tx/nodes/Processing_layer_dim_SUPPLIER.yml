name: dim_SUPPLIER
id: bed34b64-80d7-4588-8b3b-0b2eff4510f5
storageLocationId: f444de18-2d02-4df6-9c54-36ca0a2c7e40
templateId: 7c988c83-361c-42f7-a54a-158e98d0e635
materialization: table
isSource: false
columns:
  - name: SUPPLIER_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: c53376fd-6bac-44ba-bf16-6eedbe60db59
    isPK: true
    isBK: true
  - name: __FROM_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: when record was loaded into the warehouse
    id: 90be94bb-93da-4059-adba-3add2daf0ebf
    isPK: true
  - name: __TO_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: effective date or surrogate high date (9999-12-31)
    id: c029d50c-71d7-4967-b2e2-eeb7bf1ae1e5
  - name: NAME
    dataType: varchar(16777216)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 596a811d-a63b-431c-8e02-f5c63951622b
  - name: ADDRESS
    dataType: varchar(16777216)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 130db46c-5d37-4fae-9ff7-0f54752a6690
  - name: LOCATION_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 3560db3c-93b9-4df8-b30b-a81d36849b9d
  - name: PHONE
    dataType: varchar(16777216)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 32a1e12f-b2eb-4237-8156-08101597a7e1
    isDELTA: true
  - name: ACCOUNT_BALANCE_USD
    dataType: number(12,2)
    allowNulls: false
    defaultValue: ''
    description: ''
    id: 78bdd9de-b245-4ab6-b0ba-6f3bb6bcabdb
    isDELTA: true
  - name: COMMENT
    dataType: varchar(16777216)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: 93e7786d-9ca1-418b-a9e4-3974ab2751c6
  - name: __LOAD_DTS
    dataType: timestamp_ltz(9)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: 0235665e-c915-4030-a53b-05fb2a50b713
    issysTimestamp: true
  - name: __REC_VERSION
    dataType: number(38,0)
    allowNulls: false
    defaultValue: '1'
    description: incremental change version counter for the record
    id: 38fa84bb-6523-4912-9fc3-027bab7b06e7
  - name: __IS_LATEST
    dataType: boolean
    allowNulls: false
    defaultValue: 'true'
    description: true only on the latest effective dated record
    id: bc8dd615-ed36-4608-8e76-a3f152ea9f53
  - name: __CREATE_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was first created
    id: dcd772bf-d4ee-4bb3-b4bd-399692824bfc
  - name: __UPDATE_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was last updated
    id: 310c0bf7-8504-45e1-80a3-8d7e24e55501
  - name: __T2DIFF_HASH
    dataType: binary(20)
    allowNulls: false
    defaultValue: ''
    description: hash of all columns used for quick compare
    id: 343d81ca-610b-484b-aa2a-c890ea2f7407
  - name: __T1DIFF_HASH
    dataType: binary(20)
    allowNulls: false
    defaultValue: ''
    description: hash of all columns used for quick compare
    id: 728383c5-1453-46d1-94dc-38f68fc9cd4d
columnSets:
  - id: a7ec3db1-5b94-4b48-be7f-91c8ed3b35e7
    itemName: PK
    setName: PK_dim_SUPPLIER
    columns:
      - columnId: c53376fd-6bac-44ba-bf16-6eedbe60db59
        position: 1
        name: SUPPLIER_ID
        useQuotes: false
      - columnId: 90be94bb-93da-4059-adba-3add2daf0ebf
        position: 2
        name: __FROM_DTS
        useQuotes: false
  - id: f47ce778-4ba8-4c15-8760-9c8309b592e1
    itemName: sysTimestamp
    setName: sysTimestamp_dim_SUPPLIER
    columns:
      - columnId: 0235665e-c915-4030-a53b-05fb2a50b713
        position: 1
        name: __LOAD_DTS
        useQuotes: false
  - id: ea6ce8d0-ca61-4e23-8942-4f4e012be67e
    itemName: BK
    setName: BK_dim_SUPPLIER
    columns:
      - columnId: c53376fd-6bac-44ba-bf16-6eedbe60db59
        position: 1
        name: SUPPLIER_ID
        useQuotes: false
  - id: 6cb5d8f7-c3d0-4d8c-a869-c4080af89dca
    itemName: DELTA
    setName: DELTA_dim_SUPPLIER
    columns:
      - columnId: 32a1e12f-b2eb-4237-8156-08101597a7e1
        position: 1
        name: PHONE
        useQuotes: false
      - columnId: 78bdd9de-b245-4ab6-b0ba-6f3bb6bcabdb
        position: 2
        name: ACCOUNT_BALANCE_USD
        useQuotes: false
nodeFormat: dynamic
preCreate:
  value:
    - ''
  isValidated: true
postCreate:
  value:
    - ''
  isValidated: true
preRun:
  value:
    - ''
  isValidated: true
postRun:
  value:
    - ''
  isValidated: true
AllDelta: false
rely_button: true
parentName: Processing_layer
status: ValidateRunFailed
color: '#8E44AD'
logic: |-
  with "SUPPLIER" as (
      SELECT
          "SUPPLIER_ID",
          "NAME",
          "ADDRESS",
          "LOCATION_ID",
          "PHONE",
          "ACCOUNT_BALANCE_USD",
          "COMMENT",
          "__LOAD_DTS"
      FROM {{ref('RAW', 'SUPPLIER')}}
      WHERE TRUE 
    AND {% for colSet in columnSets -%}
                 {%- if colSet.itemName == 'sysTimestamp' -%}
                   {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} {{' '-}}
                   {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
                   {%- endif -%}
                 {%- endif -%}
               {%- endfor -%} 
    = (SELECT MAX( {%- for colSet in columnSets -%}
                 {%- if colSet.itemName == 'sysTimestamp' -%}
                   {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} 
                   {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
                   {%- endif -%}
                 {%- endif -%}
               {%- endfor -%}) FROM {{ref('RAW', 'SUPPLIER')}})  
  )
  ,
  common as (
      SELECT
          "SUPPLIER"."SUPPLIER_ID",
          {% for colSet in columnSets -%}
    {%- if colSet.itemName == 'sysTimestamp' -%}
      {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} {{' '-}}
      {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%} 
   AS "__FROM_DTS",
          '9999-12-31'::TIMESTAMP_NTZ AS "__TO_DTS",
          "SUPPLIER"."NAME",
          "SUPPLIER"."ADDRESS",
          "SUPPLIER"."LOCATION_ID",
          "SUPPLIER"."PHONE",
          "SUPPLIER"."ACCOUNT_BALANCE_USD",
          "SUPPLIER"."COMMENT",
          "SUPPLIER"."__LOAD_DTS",
          1 AS "__REC_VERSION",
          true AS "__IS_LATEST",
          CURRENT_TIMESTAMP() AS "__CREATE_DTS",
          CURRENT_TIMESTAMP() AS "__UPDATE_DTS",
          SHA1_BINARY( {%- for col in columns if  ( not ( col.name == '__REC_VERSION' or
                                 col.name == '__IS_LATEST' or
                                 col.name == '__FROM_DTS' or
                                 col.name == '__TO_DTS' or
                                 col.name == '__CREATE_DTS' or
                                 col.name == '__UPDATE_DTS' or 
                                 col.name == '__T2DIFF_HASH' or
                                 col.name == '__T1DIFF_HASH' or
                                 col.isSysTimestamp ) 
                                 and (
                                  col.name == 'SUPPLIER_ID' or
                                 isAllDelta
                                 )
                                 ) %}  
      NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}                        
    {%- endfor %} 
          )::BINARY(20) AS "__T2DIFF_HASH",
          SHA1_BINARY({% if isAllDelta -%} '*null*'{% else %}
      {%- for col in columns if not ( col.name == '__REC_VERSION' or
                                    col.name == '__IS_LATEST' or
                                    col.name == '__FROM_DTS' or
                                    col.name == '__TO_DTS' or
                                    col.name == '__CREATE_DTS' or
                                    col.name == '__UPDATE_DTS' or 
                                    col.name == '__T2DIFF_HASH' or
                                    col.name == '__T1DIFF_HASH' or
                                    col.isDelta or
                                    col.isSysTimestamp  ) %}  
       NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}
        {%- endfor -%} 
    {% endif -%}
    )::BINARY(20) AS "__T1DIFF_HASH"
      FROM "SUPPLIER"
  )

  SELECT * FROM common
description: ''
logicalName: SUPPLIER dimension
references:
  76c49741-003b-41d7-b8a6-fbf0f1c7932f:
    parentTableId: 3a6e1d05-5999-4e6e-b3a8-053d74649db6
    id: 76c49741-003b-41d7-b8a6-fbf0f1c7932f
