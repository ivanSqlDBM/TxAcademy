name: dim_INVENTORY
id: 2be1451c-cd32-4589-ac28-f49af2d74ee9
storageLocationId: f444de18-2d02-4df6-9c54-36ca0a2c7e40
templateId: 5a7aea4c-5adb-41ae-a296-300f66bbd5e4
materialization: table
isSource: false
columns:
  - name: PART_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: part of unique identifier with ps_suppkey
    id: 9d1608d2-51a5-4af8-867c-57397b355826
    isPK: true
  - name: SUPPLIER_ID
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: part of unique identifier with ps_partkey
    id: 288e487c-d9fc-44d3-ad0e-b589e0ea208e
    isPK: true
  - name: __FROM_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: when record was loaded into the warehouse
    id: 5d9344be-b5c0-40a0-8349-a8290b90874e
    isPK: true
  - name: __TO_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: effective date or surrogate high date (9999-12-31)
    id: 59c03106-0943-45e1-b634-4fb71a4fb19e
  - name: AVAILABLE_AMOUNT
    dataType: number(38,0)
    allowNulls: false
    defaultValue: ''
    description: number of parts available for sale
    id: b45dd5eb-8fd9-4578-a9ca-72c927cf7bee
  - name: SUPPLIER_COST_USD
    dataType: number(12,2)
    allowNulls: false
    defaultValue: ''
    description: original cost paid to supplier
    id: ccccbafa-b578-4594-b99d-bf578620b373
  - name: COMMENT
    dataType: varchar(16777216)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: e904166b-5fa2-4f0b-a7d8-e85b673dc492
  - name: __LOAD_DTS
    dataType: timestamp_ltz(9)
    allowNulls: true
    defaultValue: ''
    description: ''
    id: 28531661-e875-4aa0-abb5-091e28ff04dd
  - name: __REC_VERSION
    dataType: number(38,0)
    allowNulls: false
    defaultValue: '1'
    description: incremental change version counter for the record
    id: 81b7cd94-c871-466a-9a30-e90015a452d5
  - name: __IS_LATEST
    dataType: boolean
    allowNulls: false
    defaultValue: 'true'
    description: true only on the latest effective dated record
    id: 00ca7f71-6b0d-4636-9cda-70a597158de6
  - name: __CREATE_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was first created
    id: e784858b-3b15-4633-b619-e1e11d9f2df1
  - name: __UPDATE_DTS
    dataType: timestamp_ntz
    allowNulls: false
    defaultValue: CURRENT_TIMESTAMP()
    description: date when record was last updated
    id: 859e26ce-2edf-47da-8289-c02b5c569cde
  - name: __T2DIFF_HASH
    dataType: binary(20)
    allowNulls: false
    defaultValue: ''
    description: hash of all columns used for quick compare
    id: e70b26fe-0bf6-4091-9739-2655be7bc8f1
  - name: __T1DIFF_HASH
    dataType: binary(20)
    allowNulls: false
    defaultValue: ''
    description: hash of all columns used for quick compare
    id: f44bd004-878c-49ce-a8a2-565bc6ab1f77
columnSets:
  - id: 6aecbe47-150c-41a4-82fa-c0a505f3e38f
    itemName: PK
    setName: PK_dim_INVENTORY
    columns:
      - columnId: 9d1608d2-51a5-4af8-867c-57397b355826
        position: 1
        name: PART_ID
        useQuotes: false
      - columnId: 288e487c-d9fc-44d3-ad0e-b589e0ea208e
        position: 2
        name: SUPPLIER_ID
        useQuotes: false
      - columnId: 5d9344be-b5c0-40a0-8349-a8290b90874e
        position: 3
        name: __FROM_DTS
        useQuotes: false
nodeFormat: dynamic
preCreate:
  value:
    - ''
  isValidated: true
postCreate:
  value:
    - ''
  isValidated: true
preRun:
  value:
    - ''
  isValidated: true
postRun:
  value:
    - ''
  isValidated: true
AllDelta: true
rely_button: true
parentName: Processing_layer
color: '#8E44AD'
logic: |-
  with "INVENTORY" as (
      SELECT
          "PART_ID",
          "SUPPLIER_ID",
          "AVAILABLE_AMOUNT",
          "SUPPLIER_COST_USD",
          "COMMENT",
          "__LOAD_DTS"
      FROM {{ref('RAW', 'INVENTORY')}}
  )
  ,
  common as (
      SELECT
          "INVENTORY"."PART_ID",
          "INVENTORY"."SUPPLIER_ID",
          {% for colSet in columnSets -%}
    {%- if colSet.itemName == 'sysTimestamp' -%}
      {%- if colSet.columns[0].name | length > 0 -%}   {{ wrapColInQuotes(colSet.columns[0]) }} {{' '-}}
      {%- else -%} 'Please designate the system timestamp field in the ''System timestamp column'' column set'
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%} 
   AS "__FROM_DTS",
          '9999-12-31'::TIMESTAMP_NTZ AS "__TO_DTS",
          "INVENTORY"."AVAILABLE_AMOUNT",
          "INVENTORY"."SUPPLIER_COST_USD",
          "INVENTORY"."COMMENT",
          "INVENTORY"."__LOAD_DTS",
          1 AS "__REC_VERSION",
          true AS "__IS_LATEST",
          CURRENT_TIMESTAMP() AS "__CREATE_DTS",
          CURRENT_TIMESTAMP() AS "__UPDATE_DTS",
          SHA1_BINARY( {%- for col in columns if  ( not ( col.name == '__REC_VERSION' or
                                 col.name == '__IS_LATEST' or
                                 col.name == '__FROM_DTS' or
                                 col.name == '__TO_DTS' or
                                 col.name == '__CREATE_DTS' or
                                 col.name == '__UPDATE_DTS' or 
                                 col.name == '__T2DIFF_HASH' or
                                 col.name == '__T1DIFF_HASH' or
                                 col.isSysTimestamp ) 
                                 and (
                                 col.isDelta or
                                 isAllDelta
                                 )
                                 ) %}  
      NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}                        
    {%- endfor %} 
          )::BINARY(20) AS "__T2DIFF_HASH",
          SHA1_BINARY({% if isAllDelta -%} '*null*'{% else %}
      {%- for col in columns if not ( col.name == '__REC_VERSION' or
                                    col.name == '__IS_LATEST' or
                                    col.name == '__FROM_DTS' or
                                    col.name == '__TO_DTS' or
                                    col.name == '__CREATE_DTS' or
                                    col.name == '__UPDATE_DTS' or 
                                    col.name == '__T2DIFF_HASH' or
                                    col.name == '__T1DIFF_HASH' or
                                    col.isDelta or
                                    col.isSysTimestamp  ) %}  
       NVL(UPPER(TRIM({{wrapColInQuotes(col)}}::VARCHAR)),'^^') {%- if not loop.last %} || '|' || {% endif %}
        {%- endfor -%} 
    {% endif -%}
    )::BINARY(20) AS "__T1DIFF_HASH"
      FROM "INVENTORY"
  )

  SELECT * FROM common
description: ''
logicalName: INVENTORY dimension
references:
  496b829b-992a-42ff-b5df-ac06db67aa4c:
    parentTableId: 05482f6b-5f10-4b87-b611-bf986c50636a
    id: 496b829b-992a-42ff-b5df-ac06db67aa4c
